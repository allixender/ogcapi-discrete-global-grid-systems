[appendix,obligation="informative"]
:appendix-caption: Annex
[[annex_examples]]
== Examples
This annex provides a set of examples illustrating requests and responses for retrieving DGGS zone data and performing zone queries using capabilities defined by this DGGS API.

=== Collection description
DGGS resources can be attached to an https://docs.ogc.org/DRAFTS/20-024.html[_OGC API - Common - Part 2_] collection origin.
The following global GEBCO 2014 bathymetry collection will be used as an example:

https://maps.gnosis.earth/ogcapi/collections/gebco?f=json[\https://maps.gnosis.earth/ogcapi/collections/gebco]

An example JSON response for this collection description resource, as defined by Common - Part 2 and the <<rc_collection-dggs, Collection DGGS Requirement Class>>, is presented below, including a link to the list of available DGGRSs:

[%unnumbered%]
[source,json]
----
{
   "id" : "gebco",
   "title" : "GEBCO 2014",
   "description" : "General Bathymetric Chart of the Oceans (2014)",
   "attribution" : "General Bathymetric Chart of the Oceans (<a href='https://www.gebco.net/news_and_media/gebco_2014_grid.html'>GEBCO_2014</a>)",
   "extent" : {
      "spatial" : {
         "bbox" : [ [ -180, -90, 180, 90 ] ],
         "grid" : [
            { "cellsCount" : 65537, "resolution" : 0.0054931640625 },
            { "cellsCount" : 32769, "resolution" : 0.0054931640625 }
         ]
   } },
   "minScaleDenominator" : 2183915.0938621787354,
   "minCellSize" : 0.0054931640625,
   "links" : [
      { "rel" : "self", "title" : "Information about this GEBCO data collection",
        "href" : "/ogcapi/collections/gebco"
      },
      { "rel" : "[ogc-rel:schema]",  "title" : "Schema",
         "href" : "/ogcapi/collections/gebco/schema"
      },
      { "rel" : "[ogc-rel:queryables]",  "title" : "Queryables",
         "href" : "/ogcapi/collections/gebco/queryables"
      },
      { "rel" : "[ogc-rel:dggrs-list]", "title" : "Available DGGRSs for this GEBCO data collection",
        "href" : "/ogcapi/collections/gebco/dggs"
      }
   ]
}
----

=== Listing available DGGRSs
Whether accessing DGGS resources for the root of an API/dataset or for a particular collection, the first DGGS-specific request made by a client would be to list the available DGGRSs.
Following the link obtained from the previous example response, a client can determine which DGGRSs are supported by the API at that end-point:

https://maps.gnosis.earth/ogcapi/collections/gebco/dggs?f=json[\https://maps.gnosis.earth/ogcapi/collections/gebco/dggs]

An example JSON response for this DGGRS list, as defined by the <<rc_core,Core requirement class>>, is presented below:

[%unnumbered%]
[source,json]
----
{
   "links" : [
      { "rel" : "[ogc-rel:geodata]", "href" : "/ogcapi/collections/gebco" }
   ],
   "dggrs" : [
      {
         "id" : "GNOSISGlobalGrid",
         "title" : "GNOSIS Global Grid",
         "uri" : "[ogc-dggrs:GNOSISGlobalGrid]",
         "links" : [
            { "rel" : "self", "title" : "GNOSISGlobalGrid DGGRS for GEBCO",
              "href" : "/ogcapi/collections/gebco/dggs/GNOSISGlobalGrid" },
            { "rel" : "[ogc-rel:dggrs-definition]", "title" : "GNOSISGlobalGrid DGGRS definition",
              "href" : "/ogcapi/dggrs/GNOSISGlobalGrid"
            }
         ]
      },
      {
         "id" : "ISEA9R",
         "title" : "ISEA Aperture 9 Rhombic",
         "uri" : "[ogc-dggrs:ISEA9R]",
         "links" : [
            { "rel" : "self", "title" : "ISEA9R DGGRS for GEBCO",
              "href" : "/ogcapi/collections/gebco/dggs/ISEA9R"
            },
            { "rel" : "[ogc-rel:dggrs-definition]", "title" : "ISEA9R DGGRS definition",
              "href" : "/ogcapi/dggrs/ISEA9R"
            }
         ]
      },
      {
         "id" : "ISEA3H",
         "title" : "ISEA Aperture 3 Hexagonal",
         "uri" : "[ogc-dggrs:ISEA3H]"
         "links" : [
            { "rel" : "self", "title" : "ISEA3H DGGRS for GEBCO",
              "href" : "/ogcapi/collections/gebco/dggs/ISEA3H"
            },
            { "rel" : "[ogc-rel:dggrs-definition]", "title" : "ISEA3H DGGRS definition",
              "href" : "/ogcapi/dggrs/ISEA3H"
            }
         ]
      }
   ]
}
----

See <<annex-dggrs-def,annex B>> for examples of DGGRS definition responses (including for the <<isea3h-dggrs,ISEA3H DGGRS>> used in these examples) which the client could obtain by following the `[ogc-rel:dggrs-definition]` links.

=== Retrieving the description of a specific DGGRS
A client would then select a particular DGGRS of which it already has built-in knowledge, possibly using a software library implementing support for one or more DGGRS available from the server.

IMPORTANT: This DGGS API is intended primarily for client / server exchanges where both parties are familiar and can efficiently deal with the same DGGRS.
Use cases where the client itself also acts as a server as part of data integration workflows are particularly relevant, where the combination of
advanced spatial queries with the ability to request data for specific zones of interest can potentially greatly accelerate analytic processing
through parallel distributed processing and lazy evaluation.

As a fallback, a client without native support for a particular DGGRS can still retrieve and interpret data from a server implementing support for both
zone queries and data retrieval by performing a two-steps operation. First, the client can perform a zone query for an area of interest using the `bbox` query parameter.
Then, the client can request data for the zones returned by this query in a georeferenced encoding which it understands and which is not tightly coupled with the DGGS (excluding e.g.,the <<rc_data-json,DGGS-JSON>> encoding), such as GeoJSON or GeoTIFF.
However, for such use cases, OGC API - DGGS does not present significant advantages over other OGC API data access mechanisms such as
https://docs.ogc.org/DRAFTS/19-087.html[OGC API - Coverages], https://docs.ogc.org/is/17-069r4/17-069r4.html[OGC API - Features] or https://docs.ogc.org/is/20-057/20-057.html[OGC API - Tiles].

In this example, the client selects the <<isea3h-dggrs,ISEA3H DGGRS>> (because it has built-in support for it) and follows the link to obtain a complete description of the DGGRS:

https://maps.gnosis.earth/ogcapi/collections/gebco/dggs/ISEA3H?f=json[\https://maps.gnosis.earth/ogcapi/collections/gebco/dggs/ISEA3H]

An example JSON response for this DGGRS description, as defined by the <<rc_core,Core requirement class>>, is presented below.
Note how the description is more comprehensive than the summary description included for each item in the previous DGGRS list response, including a description,
a default (relative) depth as well as additional links and link templates.

[%unnumbered%]
[source,json]
----
{
   "id" : "ISEA3H",
   "title" : "ISEA Aperture 3 Hexagonal",
   "description" : "A Discrete Global Grid Reference System based on the Icosahedral Snyder Equal Area projection, with aperture 3 hexagonal zones, using an indexing scheme based on ISEA9R.",
   "uri" : "[ogc-dggrs:ISEA3H]",
   "defaultDepth": 10,
   "maxRefinementLevel": 18,
   "links" : [
      { "rel" : "self", "title" : "ISEA3H DGGRS for GEBCO",
        "href" : "/ogcapi/collections/gebco/dggs/ISEA3H"
      },
      { "rel" : "[ogc-rel:dggrs-definition]", "title" : "ISEA3H DGGRS definition",
        "href" : "/ogcapi/dggrs/ISEA3H"
      },
      { "rel" : "[ogc-rel:dggrs-zone-query]", "title" : "ISEA3H DGGRS Zone Query",
        "href" : "/ogcapi/collections/gebco/dggs/ISEA3H/zones"
      },
      { "rel" : "[ogc-rel:geodata]", "href" : "/ogcapi/collections/gebco" }
   ],
   "linkTemplates" : [
      {
         "rel" : "[ogc-rel:dggrs-zone-info]",
         "title" : "DGGRS zone information for a particular ISEA3H zone",
         "href" : "/ogcapi/collections/gebco/dggs/ISEA3H/zones/{zoneId}"
      },
      {
         "rel" : "[ogc-rel:dggrs-zone-data]",
         "title" : "Data retrieval for a particular ISEA3H zone",
         "href" : "/ogcapi/collections/gebco/dggs/ISEA3H/zones/{zoneId}/data"
      }
   ]
}
----

=== Simple zone queries
Having selected a particular DGGRS, one use case for the API is for a client to perform spatial queries by requesting a list of zones.
The simplest case is to simply request a list of all available zones for a discrete global grid of a given refinement level (`zone-level`), which in the case of a particular collection implies zones
for which the collection has data.

==== Querying a particular refinement level

If no `zone-level` parameter is provided, the server is free to pick a default zone level for such queries, which would result in a reasonable number of zones returned,
based on the area and resolution of the data collection. In this example, the client will explicitly request a list of zones at refinement level 1.

By default, if `compact-zones=false` is not specified by the client, zone queries are compacted, meaning that
if all sub-zones of a parent zone would be included in the response, they get replaced by that parent zone so that fewer zones need to be enumerated.
This can result in zones of a lower refinement level being returned than the requested `zone-level`, and therefore a mix of zones of different levels.
A full globe response would thereore always result in the list of all zones of refinement level 0.
In these examples, the client will explicitly set `compact-zones=false`.

Following the `[ogc-rel:dggrs-zone-query]` link, specifying these parameters, and negotiating a <<rc_table-zone_json,JSON zone list>> response using an `Accept: application/json` header, the client requests from the end-point:

https://maps.gnosis.earth/ogcapi/collections/gebco/dggs/ISEA3H/zones?f=json&zone-level=1&compact-zones=false[\https://maps.gnosis.earth/ogcapi/collections/gebco/dggs/ISEA3H/zones?zone-level=1&compact-zones=false]

An example JSON response for this Zone Query JSON, as defined by the <<rc_zone-query,Zone Query requirement class>>, is presented below:

[%unnumbered%]
[source,json]
----
{
   "zones" : [
      "A0-0-D", "A0-0-E", "A0-0-F", "A0-0-G", "A1-0-D", "A1-0-E",
      "A1-0-F", "A2-0-D", "A2-0-E", "A2-0-F", "A3-0-D", "A3-0-E",
      "A3-0-F", "A4-0-D", "A4-0-E", "A4-0-F", "A5-0-D", "A5-0-E",
      "A5-0-F", "A6-0-D", "A6-0-E", "A6-0-F", "A7-0-D", "A7-0-E",
      "A7-0-F", "A8-0-D", "A8-0-E", "A8-0-F", "A9-0-D", "A9-0-E",
      "A9-0-F", "A9-0-H"
   ],
   "links" : [
      { "rel" : "[ogc-rel:dggrs]", "title" : "ISEA3H DGGS for GEBCO",
        "href" : "/ogcapi/collections/gebco/dggs/ISEA3H"
      },
      { "rel" : "[ogc-rel:dggrs-definition]", "title" : "ISEA3H DGGRS definition",
         "href" : "/ogcapi/dggrs/ISEA3H"
      },
      { "rel" : "[ogc-rel:geodata]", "href" : "/ogcapi/collections/gebco" }
   ],
   "linkTemplates" : [
      { "rel" : "[ogc-rel:dggrs-zone-data]", "title" : "ISEA3H data for GEBCO",
        "href" : "/ogcapi/collections/gebco/dggs/ISEA3H/zones/{zoneId}/data",
      }
   ]
}
----

The server returned all 32 zones of ISEA3H level 1 (which corresponds to a truncated icosahedron -- the traditional soccer ball pattern), because the collection has global coverage.

Servers may support additional representations of zone lists beyond JSON, such as a more compact <<rc_zone-binary64bit,binary 64-bit integers>> encoding, a <<rc_zone-geojson,GeoJSON representation>> including zone geometry
or an <<rc_zone-html,HTML representation>> for exploring datasets in a browser through the DGGS API.
Note that regardless of encoding, zone query responses can also be compressed for additional banwidth efficiency if the client and server negotiate a content encoding e.g., using `Content-Encoding: gzip`.

CAUTION: The transfer of zone geometry in zone queries is not an efficient use of the DGGS API for practical analytics purposes, since clients should already have built-in knowledge of the selected DGGRS in their local software libraries.

The ability to retrieve zone lists in a geospatial data format such as GeoJSON or <<rc_zone-geotiff,GeoTIFF>> which can readily be visualized in GIS tools is useful for **educational**, **demonstration** and **debugging** purposes.
For example, this functionality can be used to generate grids, such as those seen in <<annex-dggrs-def,annex B>> (a `crs` parameter to request an ISEA planar projection was used in that case to override the default GeoJSON CRS84),
as well the zone visualizations seen in the examples below.

A visualization of the response from negotiating `application/geo+json` for the above request is seen below.

[#img_zones_globe='{figure-caption} {counter:figure-num}']
.GeoJSON response for zone query for ISEA3H DGGRS at level 1 visualized in QGIS
image::images/zones-globe-isea3h-level1.png[width=700,align="center"]

==== Querying for a spatio-temporal subset

To request a list of zones for an area of interest, the `bbox` or `subset` query parameter can be used.
For a temporal DGGS, `datetime` can be used as well as `subset=time(...)` to constrain the query to a time of interest.
For restricting the same zone query to a bounding box area from (40°N, 30°E) to (60°N,50°E), the client could make either of the following requests:

https://maps.gnosis.earth/ogcapi/collections/gebco/dggs/ISEA3H/zones?f=json&bbox=30,40,50,60&zone-level=1&compact-zones=false["\https://maps.gnosis.earth/ogcapi/collections/gebco/dggs/ISEA3H/zones?bbox=30,40,50,60&zone-level=1&compact-zones=false"]

https://maps.gnosis.earth/ogcapi/collections/gebco/dggs/ISEA3H/zones?f=json&subset=Lat(40:60),Lon(30:50)&zone-level=1&compact-zones=false["\https://maps.gnosis.earth/ogcapi/collections/gebco/dggs/ISEA3H/zones?subset=Lat(40:60),Lon(30:50)&zone-level=1&compact-zones=false"]

and obtain the following response (negotiating a JSON zone list again):

[%unnumbered%]
[source,json]
----
{
   "zones" : [ "A0-0-G", "A6-0-E" ],
   "links" : [
      { "rel" : "[ogc-rel:dggrs]", "title" : "ISEA3H DGGS for GEBCO",
        "href" : "/ogcapi/collections/gebco/dggs/ISEA3H"
      },
      { "rel" : "[ogc-rel:dggrs-definition]", "title" : "ISEA3H DGGRS definition",
         "href" : "/ogcapi/dggrs/ISEA3H"
      },
      { "rel" : "[ogc-rel:geodata]", "href" : "/ogcapi/collections/gebco" }
   ],
   "linkTemplates" : [
      { "rel" : "[ogc-rel:dggrs-zone-data]", "title" : "ISEA3H data for GEBCO",
        "href" : "/ogcapi/collections/gebco/dggs/ISEA3H/zones/{zoneId}/data",
      }
   ]
}
----

This time, the server returned only two zones of ISEA3H level 1.

A visualization of the response from negotiating `application/geo+json` for the above request, together with the bounding box used, is seen below.

[#img_zones_globe='{figure-caption} {counter:figure-num}']
.GeoJSON response for zone query for ISEA3H DGGRS at level 1 for a (40°N, 30°E) to (60°N,50°E) bounding box visualized in QGIS
image::images/zones-globe-isea3h-level1-bbox.png[width=300,align="center"]

As seen below, an HTML representation could include rendered previews of the data for the zone area, summary information, as well as links to retrieve the data and access the zone information resource for each zone.
Note that the significant variance in area (-11.31% and +6.66% from the reference mean zone (whose area is calculated by dividing the Earth surface by the tota number of zones) is due to the the fact that `A0-0-G` is a pentagon (in the ISEA projection -- on the Earth surface it looks more like a decagon) which occupies 5/6th the
area of hexagons such as `A6-0-E` (which on the Earth surface is one of the hexagons appearing as a nonagon), as well as the fact that at level 1, the number of pentagons (12) is significant compared to the total number of zones (32).

[#img_zones_html='{figure-caption} {counter:figure-num}']
.Sample HTML response for a zone query for ISEA3H DGGRS at level 1 for a (40°N, 30°E) to (60°N,50°E) bounding box
image::images/zones-bbox-html.png[width=700,align="center"]

Of course with a higher zone level, many more zones can be returned:

https://maps.gnosis.earth/ogcapi/collections/gebco/dggs/ISEA3H/zones?f=json&bbox=30,40,50,60&zone-level=8&compact-zones=false["\https://maps.gnosis.earth/ogcapi/collections/gebco/dggs/ISEA3H/zones?bbox=30,40,50,60&zone-level=8&compact-zones=false"]

[#img_zones_bbox_isea3h='{figure-caption} {counter:figure-num}']
.Sample HTML response for a zone query for ISEA3H DGGRS at level 8 for a (40°N, 30°E) to (60°N,50°E) bounding box
image::images/zones-bbox-isea3h.png[width=500,align="center"]

==== Zones representing data availability

The following example illustrates the case of a collection (elevation data from https://viewfinderpanoramas.org/[Viewfinder Panoramas]) which does not have data for everywhere on the globe (only over land), using a higher zone level of 6 for the query.

https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/ISEA3H/zones?f=json&zone-level=6&compact-zones=false[\https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/ISEA3H/zones?zone-level=6&compact-zones=false]

[#img_zones_srtm_l6='{figure-caption} {counter:figure-num}']
.GeoJSON response for zone query for ISEA3H DGGRS at level 6 for a https://viewfinderpanoramas.org/[Viewfinder Panoramas] land elevation collection, visualized in QGIS
image::images/zones-srtm-isea3h-level6.png[width=700,align="center"]

Using a bounding box to restrict the query to an area of interest, a higher zone level of 10 could be used:

https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/ISEA3H/zones?f=json&zone-level=10&bbox=30,40,50,50&compact-zones=false["\https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/ISEA3H/zones?zone-level=10&bbox=30,40,50,50&compact-zones=false"]

[#img_zones_srtm_l10_bbox='{figure-caption} {counter:figure-num}']
.GeoJSON response for zone query for ISEA3H DGGRS at level 10, using a (40°N, 30°E) to (40°N,50°E) bounding box, for a https://viewfinderpanoramas.org/[Viewfinder Panoramas] land elevation collection, visualized in QGIS
image::images/zones-srtm-isea3h-level10-bbox.png[width=500,align="center"]

The DGGS API works independently of the nature of the data, whether dealing with gridded coverage or vector features, allowing to easily perform complex analytics involving heterogeneous data sources.
The previous examples all used gridded coverage data sources. The following example illustrates the same capabilities using the Natural Earth states and provinces collection:

https://maps.gnosis.earth/ogcapi/collections/NaturalEarth:cultural:ne_10m_admin_1_states_provinces/dggs/ISEA3H/zones?f=json&zone-level=6&compact-zones=false[\https://maps.gnosis.earth/ogcapi/collections/NaturalEarth:cultural:ne_10m_admin_1_states_provinces/dggs/ISEA3H/zones?zone-level=6&compact-zones=false]

[#img_zones_nestates='{figure-caption} {counter:figure-num}']
.GeoJSON response for zone query for ISEA3H DGGRS at level 6, for a https://naturalearthdata.com/[Natural Earth] states and provinces collection, visualized in QGIS
image::images/zones-states-isea3h.png[width=700,align="center"]

The similarity between the response for this collection of states and provinces features compared to the same request earlier for a gridded elevation coverages showcases the potential for DGGS zone queries to facilitate data integration.

==== Querying sub-zones of a parent zone

The Zone Query requirement class defines the `parent-zone` query parameter as one more way how to restrict the query spatially (and temporally in the case of a temporal DGGRS), which is particularly useful for hierarchical exploration.
For example, to restrict the query to sub-zones of `A6-0-E` rather than using a bounding box, the client could perform the following request (at level 8):

https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/ISEA3H/zones?f=json&zone-level=8&parent-zone=A6-0-E&compact-zones=false[\https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/ISEA3H/zones?zone-level=8&parent-zone=A6-0-E&compact-zones=false]

[#img_zones_srtm_l8_parent_zone='{figure-caption} {counter:figure-num}']
.GeoJSON response for zone query for ISEA3H DGGRS at level 8, for parent zone https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/ISEA3H/zones/A6-0-E[A6-0-E], for a https://viewfinderpanoramas.org/[Viewfinder Panoramas] land elevation collection, visualized in QGIS
image::images/zones-srtm-isea3h-level8-parent-zone.png[width=500,align="center"]

The client could then pick one of the returned zones, say `E6-317-A`, for deeper exploration at level 16:

https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/ISEA3H/zones?f=json&zone-level=16&parent-zone=E6-317-A&compact-zones=false[\https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/ISEA3H/zones?zone-level=16&parent-zone=E6-317-A&compact-zones=false]

[#img_zones_srtm_l16_parent_zone='{figure-caption} {counter:figure-num}']
.GeoJSON response for zone query for ISEA3H DGGRS at level 16, for parent zone https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/ISEA3H/zones/E6-317-A[E6-317-A], for a https://viewfinderpanoramas.org/[Viewfinder Panoramas] land elevation collection, visualized in QGIS
image::images/zones-srtm-isea3h-level16-parent-zone.png[width=500,align="center"]

Going back to A6-0-E (a level 1 zone), this could also be used to retrieve the immediate children by requesting the next level (2), to step down the hierarchy a single refinement level at a time:

https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/ISEA3H/zones?f=json&zone-level=2&parent-zone=A6-0-E&compact-zones=false[\https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/ISEA3H/zones?zone-level=2&parent-zone=A6-0-E&compact-zones=false]

The 7 children zones (1 centroid child and 6 vertex children) are returned, since they all contain data.

[#img_zones_srtm_l10_parent_zone='{figure-caption} {counter:figure-num}']
.GeoJSON response for zone query for ISEA3H DGGRS at level 2, for parent zone https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/ISEA3H/zones/A6-0-E[A6-0-E] (outline shown), for a https://viewfinderpanoramas.org/[Viewfinder Panoramas] land elevation collection, visualized in QGIS
image::images/zones-srtm-isea3h-next-level.png[width=400,align="center"]


==== ISEA9R (rhombus) Zone Queries

Although all examples so far used the ISEA3H DGGRS, this DGGS API is completely agnostic of the DGGRS.
Future planned parts for OGC Abstract Topic 21 will standardize new categories of DGGS, including volumetric (Part 2), temporal (Part 3) and axis-aligned (Part 4).
The DGGS API functionality, as demonstrated in this examples section, is ready to handle all any DGGRS, including DGGRS based on these new DGGS types.

The following examples demonstrates equivalent zone queries using the <<isea9r-dggrs,ISEA9R DGGS>>, a dual DGGS of ISEA3H even refinement levels, which can be considered axis-aligned in a CRS derived from rotating and shearing the ISEA planar projection.
In the ISEA planar projection, the ISEA9R zones are shaped as rhombuses.

https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/ISEA9R/zones?f=json&zone-level=3&compact-zones=false[\https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/ISEA9R/zones?zone-level=3&compact-zones=false]

[#img_zones_isea9r_l3='{figure-caption} {counter:figure-num}']
.GeoJSON response for zone query for ISEA9R DGGRS at level 3 for a https://viewfinderpanoramas.org/[Viewfinder Panoramas] land elevation collection visualized in QGIS
image::images/zones-srtm-isea9r-level3.png[width=700,align="center"]

https://maps.gnosis.earth/ogcapi/collections/gebco/dggs/ISEA9R/zones?f=json&bbox=30,40,50,60&zone-level=4&compact-zones=false["\https://maps.gnosis.earth/ogcapi/collections/gebco/dggs/ISEA9R/zones?bbox=30,40,50,60&zone-level=4&compact-zones=false"]

[#img_zones_isea9r_l4_bbox='{figure-caption} {counter:figure-num}']
.GeoJSON response for zone query for ISEA9R DGGRS at level 4 for a (40°N, 30°E) to (60°N,50°E) bounding box visualized in QGIS
image::images/ISEA9R-bboxL4.png[width=500,align="center"]

https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/ISEA9R/zones?f=json&zone-level=4&parent-zone=B6-2&compact-zones=false[\https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/ISEA9R/zones?zone-level=4&parent-zone=B6-2&compact-zones=false]

[#img_zones_isea9r_l4_parent_zone_bbox='{figure-caption} {counter:figure-num}']
.GeoJSON response for zone query for ISEA9R DGGRS at level 4 for parent zone https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/ISEA9R/zones/B6-2[B6-2], for a https://viewfinderpanoramas.org/[Viewfinder Panoramas], visualized in QGIS
image::images/zones-srtm-isea9r-level4-parent-zone.png[width=500,align="center"]

https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/ISEA9R/zones?f=json&zone-level=8&parent-zone=E6-317&compact-zones=false[\https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/ISEA9R/zones?zone-level=8&parent-zone=E6-317&compact-zones=false]

[#img_zones_isea9r_l8_parent_zone_bbox='{figure-caption} {counter:figure-num}']
.GeoJSON response for zone query for ISEA9R DGGRS at level 8 for parent zone https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/ISEA9R/zones/E6-317[E6-317], for a https://viewfinderpanoramas.org/[Viewfinder Panoramas], visualized in QGIS
image::images/zones-srtm-isea9r-level8-parent-zone.png[width=500,align="center"]

Although ISEA9R is axis-aligned, like ISEA3H, it is equal area, with an error budget below 1%.

==== GNOSIS Global Grid (WGS84 rectangles) Zone Queries

The next zone query examples use the <<ggg-dggrs,GNOSIS Global Grid DGGRS>>. The GNOSIS Global Grid is also axis-aligned, with the axes being the geographic latitude and longitude.
On a plate carée projection, the zones are shaped as rectangles, which conveniently correspond to typical EPSG:4326 / CRS84 bounding boxes.

https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/GNOSISGlobalGrid/zones?f=json&zone-level=5&compact-zones=false[\https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/ISEA3H/zones?zone-level=5&compact-zones=false]

[#img_zones_ggg_l5='{figure-caption} {counter:figure-num}']
.GeoJSON response for zone query for GNOSIS Global Grid DGGRS at level 5 for a https://viewfinderpanoramas.org/[Viewfinder Panoramas] land elevation collection visualized in QGIS
image::images/zones-srtm-ggg-level5.png[width=700,align="center"]

https://maps.gnosis.earth/ogcapi/collections/gebco/dggs/GNOSISGlobalGrid/zones?bbox=30,40,50,60&zone-level=7&compact-zones=false["\https://maps.gnosis.earth/ogcapi/collections/gebco/dggs/GNOSISGlobalGrid/zones?bbox=30,40,50,60&zone-level=7&compact-zones=false"]

[#img_zones_ggg_l7_bbox='{figure-caption} {counter:figure-num}']
.GeoJSON response for zone query for GNOSIS Global Grid DGGRS at level 7 for a (40°N, 30°E) to (60°N,50°E) bounding box visualized in QGIS
image::images/ggg-bboxL7.png[width=500,align="center"]

https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/GNOSISGlobalGrid/zones?f=json&zone-level=8&parent-zone=2-2-9&compact-zones=false[\https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/GNOSISGlobalGrid/zones?zone-level=8&parent-zone=2-2-9&compact-zones=false]

[#img_zones_ggg_l8_parent_zone_bbox='{figure-caption} {counter:figure-num}']
.GeoJSON response for zone query for GNOSIS Global Grid DGGRS at level 8 for parent zone https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/GNOSISGlobalGrid/zones/2-2-9[2-2-9], for a https://viewfinderpanoramas.org/[Viewfinder Panoramas], visualized in QGIS
image::images/zones-srtm-ggg-level8-parent-zone.png[width=500,align="center"]

https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/GNOSISGlobalGrid/zones?f=json&zone-level=13&parent-zone=6-1F-98&compact-zones=false[\https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/GNOSISGlobalGrid/zones?zone-level=13&parent-zone=6-1F-98&compact-zones=false]

[#img_zones_ggg_l13_parent_zone_bbox='{figure-caption} {counter:figure-num}']
.GeoJSON response for zone query for GNOSIS Global Grid DGGRS at level 13 for parent zone https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/GNOSISGlobalGrid/zones/6-1F-98[6-1F-98], for a https://viewfinderpanoramas.org/[Viewfinder Panoramas], visualized in QGIS
image::images/zones-srtm-ggg-level13-parent-zone.png[width=500,align="center"]

=== Compact zone queries
The following examples are reprises of some of the earlier ones leaving compact zones enabled, showcasing the fewer zones being returned to communicate an identical spatial area.

==== ISEA3H compact zone queries
Compacting ISEA3H zones is complicated by the fact that sub-zones are not fully congruent.
The approach demonstrated here skips a refinement level, taking advantage of the fact that 7 of the grand-children of a zone are congruent. Overlaps are seen, as 6 holes
are left at the vertices of the grand-parent, each occupying 1/3rd the size of a congruent grand-child. Note how 7 + 6 x 1/3 = 9 (3 x 3), which corresponds to the two subsequent refinements at the refinement ratio of 3.
If the neighboring grand-parent of the same refinement level cannot be used, then the non-congruent vertex children must be included, resulting in these overlaps.

https://maps.gnosis.earth/ogcapi/collections/gebco/dggs/ISEA3H/zones?f=json&bbox=30,40,50,60&zone-level=8["\https://maps.gnosis.earth/ogcapi/collections/gebco/dggs/ISEA3H/zones?bbox=30,40,50,60&zone-level=8"]

[#img_compact_bbox_isea3h='{figure-caption} {counter:figure-num}']
.GeoJSON compact zones response querying ISEA3H DGGRS at level 8 for a (40°N, 30°E) to (60°N,50°E) bounding box
image::images/isea3h-compact-bbox.png[width=700,align="center"]

https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/ISEA3H/zones?f=json&zone-level=6[\https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/ISEA3H/zones?zone-level=6]

[#img_compact_isea3h_l6='{figure-caption} {counter:figure-num}']
.GeoJSON compact zones response for querying ISEA3H DGGRS at level 6 for a https://viewfinderpanoramas.org/[Viewfinder Panoramas] land elevation collection, visualized in QGIS
image::images/isea3h-compact-srtm.png[width=700,align="center"]

https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/ISEA3H/zones?f=json&zone-level=10&bbox=30,40,50,50["\https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/ISEA3H/zones?zone-level=10&bbox=30,40,50,50"]

[#img_compact_isea3h_l10_bbox='{figure-caption} {counter:figure-num}']
.GeoJSON compact zones response for querying ISEA3H DGGRS at level 10, using a (40°N, 30°E) to (40°N,50°E) bounding box, for a https://viewfinderpanoramas.org/[Viewfinder Panoramas] land elevation collection, visualized in QGIS
image::images/compact-srtm-isea3h-level10-bbox.png[width=500,align="center"]

https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/ISEA3H/zones?f=json&zone-level=16&parent-zone=E6-317-A[\https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/ISEA3H/zones?zone-level=16&parent-zone=E6-317-A]

[#img_compact_srtm_l16_parent_zone='{figure-caption} {counter:figure-num}']
.GeoJSON compact zones response for querying ISEA3H DGGRS at level 16, for parent zone https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/ISEA3H/zones/E6-317-A[E6-317-A], for a https://viewfinderpanoramas.org/[Viewfinder Panoramas] land elevation collection, visualized in QGIS
image::images/compact-srtm-isea3h-level16-parent-zone.png[width=500,align="center"]

==== ISEA9R compact zone queries
Compacting ISEA9R zones can be achieved quite simply given that all sub-zones are fully congruent.

https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/ISEA9R/zones?f=json&zone-level=3[\https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/ISEA9R/zones?zone-level=3]

[#img_compact_isea9r_l3='{figure-caption} {counter:figure-num}']
.GeoJSON compact zones response for querying ISEA9R DGGRS at level 3 for a https://viewfinderpanoramas.org/[Viewfinder Panoramas] land elevation collection visualized in QGIS
image::images/compact-srtm-isea9r-level3.png[width=700,align="center"]

https://maps.gnosis.earth/ogcapi/collections/gebco/dggs/ISEA9R/zones?f=json&bbox=30,40,50,60&zone-level=4["\https://maps.gnosis.earth/ogcapi/collections/gebco/dggs/ISEA9R/zones?bbox=30,40,50,60&zone-level=4"]

[#img_compact_isea9r_l4_bbox='{figure-caption} {counter:figure-num}']
.GeoJSON compact zones response for querying ISEA9R DGGRS at level 4 for a (40°N, 30°E) to (60°N,50°E) bounding box visualized in QGIS
image::images/compact-isea9r-bboxL4.png[width=500,align="center"]

https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/ISEA9R/zones?f=json&zone-level=4&parent-zone=B6-2[\https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/ISEA9R/zones?zone-level=4&parent-zone=B6-2]

[#img_compact_isea9r_l4_parent_zone_bbox='{figure-caption} {counter:figure-num}']
.GeoJSON compact zones response for querying ISEA9R DGGRS at level 4 for parent zone https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/ISEA9R/zones/B6-2[B6-2], for a https://viewfinderpanoramas.org/[Viewfinder Panoramas], visualized in QGIS
image::images/compact-srtm-isea9r-level4-parent-zone.png[width=500,align="center"]

https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/ISEA9R/zones?f=json&zone-level=8&parent-zone=E6-317[\https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/ISEA9R/zones?zone-level=8&parent-zone=E6-317]

[#img_compact_isea9r_l8_parent_zone_bbox='{figure-caption} {counter:figure-num}']
.GeoJSON compact zones response for querying ISEA9R DGGRS at level 8 for parent zone https://maps.gnosis.earth/ogcapi/collections/SRTM_ViewFinderPanorama/dggs/ISEA9R/zones/E6-317[E6-317], for a https://viewfinderpanoramas.org/[Viewfinder Panoramas], visualized in QGIS
image::images/compact-srtm-isea9r-level8-parent-zone.png[width=500,align="center"]
